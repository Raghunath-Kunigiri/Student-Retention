<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Student Retention System</title>
  <link rel="stylesheet" href="../src/styles/variables.css" />
  <link rel="stylesheet" href="../src/styles/cursor.css" />
  <link rel="stylesheet" href="../src/styles/interactions.css" />
  <link rel="stylesheet" href="styles/theme.css" />
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root {
      --primary: #0d47a1;          /* deep SLU-like blue */
      --primary-2: #1565c0;        /* lighter blue */
      --accent: #2e7d32;           /* green accent */
      --text: #0f172a;             /* slate-900 */
      --muted: #475569;            /* slate-600 */
      --bg: linear-gradient(0deg, rgba(255,255,255,.90), rgba(255,255,255,.90)), url('../Images/International_Advisors_building.png') center / cover no-repeat fixed;
      --ring: 0 0 0 4px rgba(21,101,192,.15);
      --shadow: 0 18px 36px rgba(2,6,23,.16);
    }

    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      color: var(--text);
      background: var(--bg);
      min-height: 100vh;
      display: grid;
      place-items: center;
      padding: 28px;
    }

    .container {
      background: rgba(255,255,255,.96);
      backdrop-filter: blur(8px);
      border-radius: 16px;
      padding: 0;
      box-shadow: var(--shadow);
      width: 100%;
      max-width: 1200px;
      position: relative;
      overflow: hidden;
      border: 1px solid #e6eef9;
    }

    .topbar { display:flex; align-items:center; justify-content:space-between; padding: 14px 22px; background: linear-gradient(90deg, var(--primary), var(--primary-2)); color:#fff; }
    .topbar .brand { font-weight: 800; letter-spacing:.2px; }
    .topbar nav { display:flex; gap: 16px; }
    .topbar a { color:#e3f2fd; text-decoration:none; font-weight:600; }
    .topbar a:hover { text-decoration: underline; }

    .shell { display:grid; grid-template-columns: 2fr 1fr; gap: 24px; padding: 26px; }
    .welcome { background:#fff; border:1px solid #e6eef9; border-radius: 12px; padding: 24px; }
    .welcome h1 { font-size: 28px; font-weight: 900; color: var(--primary); margin-bottom: 10px; }
    .welcome p { color: var(--text); line-height: 1.6; }
    .cta { display:flex; gap: 12px; margin-top: 16px; flex-wrap: wrap; }
    .btn { display:inline-flex; align-items:center; gap:8px; padding: 12px 14px; border-radius:10px; border:1px solid #dbe7fb; background:#fff; color: var(--primary); font-weight: 700; text-decoration:none; box-shadow: 0 8px 18px rgba(13,71,161,.08); }
    .btn.primary { background: linear-gradient(135deg, var(--primary), var(--primary-2)); color:#fff; border-color: transparent; }
    .btn:hover { transform: translateY(-1px); box-shadow: 0 12px 22px rgba(13,71,161,.12); }

    .links { background:#fff; border:1px solid #e6eef9; border-radius:12px; padding: 20px; }
    .links h2 { font-size: 18px; margin-bottom: 12px; color:#0f172a; }
    .link-grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(220px,1fr)); gap: 10px; }
    .link-grid a { display:block; padding: 10px 12px; border-radius: 10px; border:1px solid #e6eef9; color:#0d47a1; text-decoration:none; background:#f8fbff; font-weight:600; }
    .link-grid a:hover { background:#eef6ff; }

    .aside { display:grid; gap: 20px; }
    .panel { background:#fff; border:1px solid #e6eef9; border-radius:12px; padding: 18px; }
    .panel h3 { font-size: 16px; margin-bottom: 10px; color:#0f172a; }
    .ann { background:#f8fbff; border:1px dashed #cfe1fb; padding: 12px; border-radius: 10px; color:#334155; }

    .shell { display: grid; grid-template-columns: 1.3fr 1fr; gap: 28px; align-items: center; }
    .logo { margin-bottom: 0; }

    .login-options { display: grid; grid-template-columns: 1fr; gap: 12px; }

    .login-card { background: #fff; border-radius: 18px; padding: 24px 20px; box-shadow: 0 10px 28px rgba(2,6,23,.08); transition: transform .12s ease, box-shadow .2s ease, border-color .2s ease; text-decoration: none; color: inherit; border: 1px solid #e8ecf7; position: relative; overflow: hidden; display:block; }

    .login-card:hover { transform: translateY(-3px); box-shadow: 0 16px 36px rgba(2,6,23,.14); border-color: rgba(99,102,241,.25); }

    .login-card.student:hover {
      border-color: rgba(102, 126, 234, 0.3);
    }

    .login-card.advisor:hover {
      border-color: rgba(240, 147, 251, 0.3);
    }

    .login-card h3 { font-size: 22px; margin-bottom: 10px; font-weight: 800; }

    .login-card.student h3 { color: var(--primary); }

    .login-card.advisor h3 { color: var(--accent); }

    .login-card p {
      color: #666;
      font-size: 14px;
      line-height: 1.5;
    }

    .icon { font-size: 44px; margin-bottom: 14px; display: block; }

    .features { display:none; }

    .features h3 {
      color: #333;
      margin-bottom: 20px;
      font-size: 20px;
    }

    .feature-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 16px; }

    .feature { background: rgba(99,102,241,.06); border: 1px solid #eef2ff; border-radius: 12px; padding: 14px; font-size: 14px; color: #555; }

    @media (max-width: 980px){ .shell { grid-template-columns: 1fr; } }
    @media (max-width: 768px) { .container { margin: 10px; } .welcome h1 { font-size: 24px; } }
  </style>
</head>
<body>
  <canvas id="particle-canvas" style="position:fixed;inset:0;pointer-events:none;z-index:9998;"></canvas>

  <div class="container">
    <div class="topbar">
      <div class="brand">Horizon State University</div>
    </div>

    <div class="shell">
      <main class="welcome">
        <div class="logo">
          <h1>Welcome to Horizon State University!</h1>
          <p>We support students and advisors with tools to track progress, manage cases, and coordinate appointments. Explore key resources below or sign in to your portal.</p>
        </div>
        <div class="login-tabs-container" style="margin-top: 24px;">
          <div class="login-tabs-header" style="display: flex; gap: 8px; margin-bottom: 16px; border-bottom: 2px solid #e5e7eb;">
            <button class="login-tab-btn active" onclick="switchLoginTab('student')" style="padding: 12px 20px; border: none; background: transparent; font-weight: 600; color: var(--primary); cursor: pointer; border-bottom: 2px solid var(--primary); margin-bottom: -2px;">Student Login</button>
            <button class="login-tab-btn" onclick="switchLoginTab('advisor')" style="padding: 12px 20px; border: none; background: transparent; font-weight: 600; color: #6b7280; cursor: pointer;">Advisor Login</button>
          </div>
          
          <!-- Student Login Form -->
          <div id="student-login-section" class="login-section active" style="display: block;">
            <form id="student-login-form-index" style="display: grid; gap: 16px;">
              <div style="display: grid; gap: 8px;">
                <label style="font-size: 14px; font-weight: 600; color: #374151;">Student ID</label>
                <input type="text" id="student-id-index" name="studentId" placeholder="Enter your student ID" required style="padding: 12px 16px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 14px;">
              </div>
              <div style="display: grid; gap: 8px;">
                <label style="font-size: 14px; font-weight: 600; color: #374151;">Password</label>
                <input type="password" id="password-student-index" name="password" placeholder="Enter your password" required style="padding: 12px 16px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 14px;">
              </div>
              <button type="submit" style="padding: 12px 20px; background: var(--primary); color: white; border: none; border-radius: 10px; font-weight: 600; cursor: pointer; margin-top: 8px;">Sign In</button>
            </form>
            <div style="margin-top: 16px; text-align: center;">
              <a href="student-login.html" style="color: var(--primary); text-decoration: none; font-size: 14px;">Need to create an account? Sign up here</a>
            </div>
          </div>
          
          <!-- Advisor Login Form -->
          <div id="advisor-login-section" class="login-section" style="display: none;">
            <form id="advisor-login-form-index" style="display: grid; gap: 16px;">
              <div style="display: grid; gap: 8px;">
                <label style="font-size: 14px; font-weight: 600; color: #374151;">Email Address</label>
                <input type="email" id="advisor-email-index" name="email" placeholder="Enter your email" required style="padding: 12px 16px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 14px;">
              </div>
              <div style="display: grid; gap: 8px;">
                <label style="font-size: 14px; font-weight: 600; color: #374151;">Password</label>
                <input type="password" id="password-advisor-index" name="password" placeholder="Enter your password" required style="padding: 12px 16px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 14px;">
              </div>
              <div style="display: grid; gap: 8px;">
                <label style="font-size: 14px; font-weight: 600; color: #374151;">Department</label>
                <select id="department-index" name="department" required style="padding: 12px 16px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 14px; background: white;">
                  <option value="">Select Department</option>
                  <option value="computer-science">Computer Science</option>
                  <option value="engineering">Engineering</option>
                  <option value="business">Business</option>
                  <option value="medicine">Medicine</option>
                  <option value="arts">Arts & Humanities</option>
                </select>
              </div>
              <button type="submit" style="padding: 12px 20px; background: var(--primary); color: white; border: none; border-radius: 10px; font-weight: 600; cursor: pointer; margin-top: 8px;">Sign In</button>
            </form>
            <div style="margin-top: 16px; text-align: center;">
              <a href="advisor-login.html" style="color: var(--primary); text-decoration: none; font-size: 14px;">Need to create an account? Sign up here</a>
            </div>
          </div>
        </div>
        
        <div id="error-message-index" style="display: none; padding: 12px; background: #fee2e2; color: #991b1b; border-radius: 8px; margin-top: 16px; font-size: 14px;"></div>
        <div id="success-message-index" style="display: none; padding: 12px; background: #d1fae5; color: #166534; border-radius: 8px; margin-top: 16px; font-size: 14px;"></div>
      </main>

      <aside class="aside">
        <div class="panel">
          <h3>Office Information</h3>
          <div style="color:#334155; line-height:1.6;">
            Monday–Friday, 8:30am–5pm<br/>
            Hall 102
          </div>
        </div>
      </aside>
    </div>
  </div>

  <script type="module" src="../src/index.js"></script>
  <script>
    function switchLoginTab(type) {
      // Update tab buttons
      const buttons = document.querySelectorAll('.login-tab-btn');
      buttons.forEach(btn => {
        btn.classList.remove('active');
        btn.style.color = '#6b7280';
        btn.style.borderBottom = 'none';
      });
      
      const activeBtn = type === 'student' ? buttons[0] : buttons[1];
      activeBtn.classList.add('active');
      activeBtn.style.color = 'var(--primary)';
      activeBtn.style.borderBottom = '2px solid var(--primary)';
      
      // Update sections
      document.getElementById('student-login-section').style.display = type === 'student' ? 'block' : 'none';
      document.getElementById('advisor-login-section').style.display = type === 'advisor' ? 'block' : 'none';
      
      // Clear messages
      document.getElementById('error-message-index').style.display = 'none';
      document.getElementById('success-message-index').style.display = 'none';
    }
    
    // Student login form submission
    document.getElementById('student-login-form-index').addEventListener('submit', async function(e) {
      e.preventDefault();
      const errorDiv = document.getElementById('error-message-index');
      const successDiv = document.getElementById('success-message-index');
      errorDiv.style.display = 'none';
      successDiv.style.display = 'none';
      
      const studentId = document.getElementById('student-id-index').value;
      const password = document.getElementById('password-student-index').value;
      
      try {
        const response = await fetch(`${window.location.origin}/api/auth/student/login`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ studentId, password })
        });
        
        const result = await response.json();
        
        if (result.success) {
          // Clean up fullName to remove "Not provided"
          let fullName = result.user.fullName || '';
          fullName = fullName.replace(/Not provided/gi, '').trim();
          fullName = fullName.replace(/\s+/g, ' ');
          
          localStorage.setItem('studentSessionToken', result.sessionToken);
          localStorage.setItem('studentId', result.user.studentId);
          localStorage.setItem('fullName', fullName);
          localStorage.setItem('email', result.user.email);
          localStorage.setItem('major', result.user.major);
          localStorage.setItem('year', result.user.year);
          
          successDiv.textContent = 'Login successful! Redirecting...';
          successDiv.style.display = 'block';
          
          setTimeout(() => {
            window.location.href = 'student-dashboard.html';
          }, 1000);
        } else {
          errorDiv.textContent = result.error || 'Login failed. Please check your credentials.';
          errorDiv.style.display = 'block';
        }
      } catch (error) {
        console.error('Login error:', error);
        errorDiv.textContent = 'Network error. Please try again.';
        errorDiv.style.display = 'block';
      }
    });
    
    // Advisor login form submission
    document.getElementById('advisor-login-form-index').addEventListener('submit', async function(e) {
      e.preventDefault();
      const errorDiv = document.getElementById('error-message-index');
      const successDiv = document.getElementById('success-message-index');
      errorDiv.style.display = 'none';
      successDiv.style.display = 'none';
      
      const email = document.getElementById('advisor-email-index').value;
      const password = document.getElementById('password-advisor-index').value;
      const department = document.getElementById('department-index').value;
      
      try {
        const response = await fetch(`${window.location.origin}/api/auth/advisor/login`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password, department })
        });
        
        const result = await response.json();
        
        if (result.success) {
          localStorage.setItem('advisorSessionToken', result.sessionToken);
          localStorage.setItem('advisorFullName', result.user.fullName);
          localStorage.setItem('advisorEmail', result.user.email);
          localStorage.setItem('advisorId', result.user.advisorId);
          localStorage.setItem('department', result.user.department);
          
          successDiv.textContent = 'Login successful! Redirecting...';
          successDiv.style.display = 'block';
          
          setTimeout(() => {
            window.location.href = 'advisor-dashboard.html';
          }, 1000);
        } else {
          errorDiv.textContent = result.error || 'Login failed. Please check your credentials.';
          errorDiv.style.display = 'block';
        }
      } catch (error) {
        console.error('Login error:', error);
        errorDiv.textContent = 'Network error. Please try again.';
        errorDiv.style.display = 'block';
      }
    });
  </script>
</body>
</html>


